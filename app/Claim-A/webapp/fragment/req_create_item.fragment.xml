<core:FragmentDefinition xmlns:table2="sap.ui.mdc.table" xmlns:form2="sap.fe.macros.form"
    xmlns="sap.m"
    xmlns:form="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:unified="sap.ui.unified"
    xmlns:table="sap.ui.table"
    xmlns:mdc="sap.ui.mdc" >
    <VBox
        id="request_create_item_fragment" 
        backgroundDesign="Solid"
        class="roundedBox sapUiSmallMargin"
        rowGap="1rem">
        <VBox width="100%" height="100%" rowGap="1rem">
            <OverflowToolbar height="3rem">
                <Title text="{i18n>req_form_detail_title}" titleStyle="H4" />
                <ToolbarSpacer />
                <MenuButton text="{i18n>req_b_save_request}" buttonMode="Split" defaultAction="onSave" beforeMenuOpen="onBeforeMenuOpen" useDefaultActionOnly="true" enabled="{= ${request>/view} !== 'view' }">
                    <menu>
                        <Menu itemSelected="onMenuAction">
                            <MenuItem text="{i18n>req_b_save_n_add}" press=".onSaveAddAnother" />
                        </Menu>
                    </menu>
                </MenuButton>
            </OverflowToolbar>
            <VBox rowGap="1rem">
                <form:Form
                    xmlns:form="sap.ui.layout.form"
                    xmlns:m="sap.m"
                    xmlns:core="sap.ui.core"
                    editable="true">

                    <form:layout>
                        <form:ColumnLayout columnsL="2" columnsM="2"></form:ColumnLayout>
                    </form:layout>

                    <form:formContainers>
                        <form:FormContainer>
                            <form:formElements>

                                <!-- Claim Type -->
                                <form:FormElement label="{i18n>req_i_claim_type}" >
                                    <form:fields>
                                        <Text text="{request>/req_header/claimtype}" />
                                    </form:fields>
                                </form:FormElement>

                                <!-- Estimated Amount -->
                                <form:FormElement label="{i18n>req_i_est_amt}">
                                    <form:fields>
                                        <m:Input 
                                            id="estAmount" 
                                            type="Number" 
                                            textAlign="Begin" 
                                            enabled="{= ${request>/view} !== 'view' }"
                                            value="{request>/req_item/est_amount}"/>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Start Date -->
                                <form:FormElement label="{i18n>req_i_start_date}">
                                    <form:fields>
                                        <m:DatePicker
                                            id="i_start_date"
                                            displayFormat="dd MMM yyyy"
                                            valueFormat="yyyy-MM-dd"
                                            placeholder="eg: 01 Jan 1990"
                                            value="{request>/req_item/start_date}"
                                            textAlign="Begin"
                                            enabled="{= ${request>/view} !== 'view' }"/>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Location -->
                                <form:FormElement label="{i18n>req_i_location}">
                                    <form:fields>
                                        <m:Input 
                                            id="i_location" 
                                            textAlign="Begin" 
                                            enabled="{= ${request>/view} !== 'view' }"
                                            value="{request>/req_item/location}"/>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Attachment 1 -->
                                <form:FormElement label="{i18n>req_attach1}">
                                    <form:fields>
                                        <unified:FileUploader
                                            id="i_attachment1"
                                            change=".onImportChange"
                                            value="{request>/req_item/doc1}" />
                                    </form:fields>
                                </form:FormElement>

                                <!-- Estimated Participants -->
                                <form:FormElement label="{i18n>req_i_estparticipant}"
                                                visible="{= ${request>/req_header/grptype} === 'group'}">
                                    <form:fields>
                                        <m:Input 
                                            id="estNoOfParticipant" 
                                            type="Number" 
                                            textAlign="Begin" 
                                            enabled="{= ${request>/view} !== 'view' }"
                                            value="{request>/req_item/est_no_participant}"/>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Claim Type Item -->
                                <form:FormElement label="{i18n>req_i_claim_type_item}">
                                    <form:fields>
                                        <Select selectedKey="{request>/req_item/claim_type_item_id}" 
                                                required="true" 
                                                forceSelection="false"
                                                items="{path: 'request>/claim_type_items',
                                                        sorter: { path: 'CLAIM_TYPE_ITEM_ID', descending: false }}">
                                            <items>
                                                <core:Item key="{request>CLAIM_TYPE_ITEM_ID}" 
                                                        text="{request>CLAIM_TYPE_ITEM_DESC}" />
                                            </items>
                                        </Select>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Cash Advance -->
                                <form:FormElement label="{i18n>req_i_cashadv}">
                                    <form:fields>
                                        <m:Select id="cash_adv" selectedKey="{request>/req_item/cash_advance}" enabled="{= ${request>/view} !== 'view' }">
                                            <items>
                                                <core:Item key="no_cashadv" text="No"/>
                                                <core:Item key="yes_cashadv" text="Yes"/>
                                            </items>
                                        </m:Select>
                                    </form:fields>
                                </form:FormElement>

                                <!-- End Date -->
                                <form:FormElement label="{i18n>req_i_end_date}">
                                    <form:fields>
                                        <m:DatePicker
                                            id="i_end_date"
                                            displayFormat="dd MMM yyyy"
                                            valueFormat="yyyy-MM-dd"
                                            placeholder="eg: 01 Jan 1990"
                                            value="{request>/req_item/end_date}"
                                            textAlign="Begin"
                                            enabled="{= ${request>/view} !== 'view' }"/>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Remarks -->
                                <form:FormElement label="{i18n>req_i_remarks}">
                                    <form:fields>
                                        <m:TextArea 
                                            id="i_remarks" 
                                            textAlign="Begin" 
                                            enabled="{= ${request>/view} !== 'view' }"
                                            value="{request>/req_item/remark}"/>
                                    </form:fields>
                                </form:FormElement>

                                <!-- Attachment 2 -->
                                <form:FormElement label="{i18n>req_attach2}">
                                    <form:fields>
                                        <unified:FileUploader
                                            id="i_attachment2"
                                            change=".onImportChange"
                                            value="{request>/req_item/doc2}" />
                                    </form:fields>
                                </form:FormElement>

                            </form:formElements>
                        </form:FormContainer>
                    </form:formContainers>
                </form:Form>
                
                <VBox rowGap="0.5rem">
                    <OverflowToolbar height="3rem">
                        <Title text="{i18n>req_participant}" titleStyle="H4" />
                        <ToolbarSpacer />
                        <Button text="{i18n>req_b_download_template}" press=".onExport"></Button>
                        <unified:FileUploader
                            id="fuImport"
                            icon="sap-icon://upload"
                            buttonOnly="true"
                            buttonText="{i18n>req_b_upload_list}"
                            fileType="csv,xlsx"
                            change=".onUploadParticipants"
                            style="Emphasized"
                            enabled="{= ${request>/view} !== 'view' }"/>
                        <Button icon="sap-icon://delete" text="{i18n>req_b_delete}" press=".onRowDeleteParticipant" enabled="{= ${request>/view} !== 'view' }"/>
                    </OverflowToolbar>
                    <table:Table 
                        id="req_participant_table"
                        rows="{request>/participant}"
                        columnHeaderHeight="3rem"
                        selectionMode="MultiToggle"
                        rowActionCount="1"
                        >
                        <table:Column width="10rem" >
                            <Label text="{i18n>req_p_id}"></Label>
                            <table:template>
                                <Input 
                                    value="{request>PARTICIPANTS_ID}" 
                                    showSuggestion="true"
                                    suggestionRows="{/ZEMP_MASTER}"
                                    suggestionItemSelected=".onParticipantInputChange"
                                    change=".onUploadParticipants"
                                    showValueHelp="true"
                                    valueHelpRequest=".onValueHelpRequest"
                                    enabled="{= ${request>/req_header/grptype} === 'group' || ${request>/view} !== 'view'}">
                                    <suggestionColumns>
                                        <Column><Label text="EEID"/></Column>
                                        <Column><Label text="Name"/></Column>
                                        <Column><Label text="Cost Center"/></Column>
                                    </suggestionColumns>
                                    <suggestionRows>
                                        <ColumnListItem>
                                            <cells>
                                                <Label text="{EEID}"/>
                                                <Label text="{NAME}"/>
                                                <Label text="{CC}"/>
                                            </cells>
                                        </ColumnListItem>
                                    </suggestionRows>
                                </Input>
                            </table:template>
                        </table:Column>
                        <table:Column width="25rem">
                            <Label text="{i18n>req_p_name}"></Label>
                            <table:template>
                                <Text text="{request>PARTICIPANT_NAME}" />
                            </table:template>
                        </table:Column>
                        <table:Column width="25rem">
                            <Label text="{i18n>req_p_cost_center}"></Label>
                            <table:template>
                                <Text text="{request>PARTICIPANT_COST_CENTER}" />
                            </table:template>
                        </table:Column>
                        <table:Column width="15rem">
                            <Label text="{i18n>req_p_alloc_amt}"></Label>
                            <table:template>
                                <Input id="alloc_amount" textAlign="End" value="{request>ALLOCATED_AMOUNT}" type="Number"
                                    enabled="{= ${request>/view} !== 'view'}"></Input>
                            </table:template>
                        </table:Column>
                        <table:rowActionTemplate>
                            <table:RowAction>
                                <table:items>
                                    <table:RowActionItem type="Delete" press="onRowDeleteParticipant" visible="{= ${request>/view} !== 'view' }"></table:RowActionItem>
                                </table:items>
                            </table:RowAction>
                        </table:rowActionTemplate>
                    </table:Table>
                </VBox>
            </VBox>
        </VBox>
    </VBox>
</core:FragmentDefinition>